<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar SesiÃ³n - PsicÃ³logo</title>

  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>

  <link rel="stylesheet" href="styles_registr.css">
</head>
<body>

  <div class="form-container">
    <h2>Iniciar SesiÃ³n</h2>

    <input id="emailLogin" type="email" placeholder="Correo electrÃ³nico" required>
    
    <div class="password-container">
      <input id="passwordLogin" type="password" placeholder="ContraseÃ±a" required>
      <span id="togglePasswordLogin" class="eye-icon" style="cursor: pointer;">ğŸ‘ï¸</span>
    </div>

    <p id="loginError" class="mensaje-error" style="display: none; color: red; font-weight: bold;"></p>
    <p id="loginExito" class="mensaje-exito" style="display: none; color: green; font-weight: bold;">âœ… Redirigiendo...</p>

    <button id="loginBtn">Entrar</button>

    <p class="extra-link">
      Â¿No tienes cuenta? <a href="registro_p.html">RegÃ­strate aquÃ­</a>
    </p>
  </div>

  <script>
    const firebaseConfig = {
        apiKey: "AIzaSyCq2lQnID4SSkFIKh_ja6paB4aHuq4KU0M",
         authDomain: "proyectercerparcial.firebaseapp.com",
  databaseURL: "https://proyectercerparcial-default-rtdb.firebaseio.com",
  projectId: "proyectercerparcial",
  storageBucket: "proyectercerparcial.appspot.com",
  messagingSenderId: "39792129165",
         appId: "1:39792129165:web:631ce9e0c7fb657a135ec4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    document.getElementById('togglePasswordLogin').addEventListener('click', function() {
        const passwordInput = document.getElementById('passwordLogin');
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
    });

    document.getElementById('loginBtn').addEventListener('click', function() {
        const email = document.getElementById('emailLogin').value;
        const password = document.getElementById('passwordLogin').value;
        const loginError = document.getElementById('loginError');
        const loginExito = document.getElementById('loginExito');

        loginError.style.display = 'none';
        loginExito.style.display = 'none';

        if (!email || !password) {
            loginError.textContent = 'Por favor, completa todos los campos';
            loginError.style.display = 'block';
            return;
        }

        const loginBtn = document.getElementById('loginBtn');
        loginBtn.textContent = 'Iniciando sesiÃ³n...';
        loginBtn.disabled = true;

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                loginExito.style.display = 'block';
                
                setTimeout(() => {
                    window.location.href = '../nav-alice-psicologo/perfilPsic.html';
                }, 1000);
            })
            .catch((error) => {
                let errorMessage = 'Error al iniciar sesiÃ³n';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Usuario no encontrado';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ContraseÃ±a incorrecta';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Email invÃ¡lido';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Demasiados intentos. Intenta mÃ¡s tarde';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                loginError.textContent = errorMessage;
                loginError.style.display = 'block';
            })
            .finally(() => {
                loginBtn.textContent = 'Entrar';
                loginBtn.disabled = false;
            });
    });

    document.getElementById('passwordLogin').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            document.getElementById('loginBtn').click();
        }
    });
  </script>
</body>
</html>